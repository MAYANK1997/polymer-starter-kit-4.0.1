import {
  DialogRoot,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogBody,
  DialogFooter,
  DialogCloseTrigger,
  Button,
  Fieldset,
  Input,
  Stack,
  Text,
  toaster,
  AlertRoot,
  AlertIndicator,
} from '@chakra-ui/react'
import { useState } from 'react'
import { useMutation, useQueryClient } from '@tanstack/react-query'

interface CreateCategoryModalProps {
  isOpen: boolean
  onClose: () => void
}

export function CreateCategoryModal({ isOpen, onClose }: CreateCategoryModalProps) {
  const queryClient = useQueryClient()
  const [categoryName, setCategoryName] = useState('')

  const createMutation = useMutation({
    mutationFn: async (name: string) => {
      // Mock API call
      await new Promise((resolve) => setTimeout(resolve, 1000))
      return { id: Math.random().toString(), restrictionCategoryName: name }
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['restriction-categories'] })
      toaster.success({
        title: 'Category Created',
        description: 'The restriction category has been created successfully.',
        duration: 3000,
      })
      setCategoryName('')
      onClose()
    },
    onError: () => {
      toaster.error({
        title: 'Error',
        description: 'Failed to create restriction category.',
        duration: 3000,
      })
    },
  })

  const handleSubmit = () => {
    if (categoryName.trim()) {
      createMutation.mutate(categoryName.trim())
    }
  }

  return (
    <DialogRoot open={isOpen} onOpenChange={(e) => !e.open && onClose()}>
      <DialogContent bg="gray.800" color="white" rounded="xl" shadow="xl">
        <DialogHeader>
          <DialogTitle>Create Restriction Category</DialogTitle>
          <DialogCloseTrigger />
        </DialogHeader>

        <DialogBody>
          <Stack spacing={4}>
            <Fieldset.Root>
              <Fieldset.Label>Category Name</Fieldset.Label>
              <Input
                value={categoryName}
                onChange={(e) => setCategoryName(e.target.value)}
                placeholder="Enter restriction category"
              />
            </Fieldset.Root>

            {createMutation.isError && (
              <AlertRoot status="error" borderRadius="md">
                <AlertIndicator />
                <Text fontSize="sm">Failed to create category. Please try again.</Text>
              </AlertRoot>
            )}
          </Stack>
        </DialogBody>

        <DialogFooter>
          <Stack direction="row" justify="flex-end" spacing={3}>
            <Button variant="outline" onClick={onClose}>
              Cancel
            </Button>
            <Button
              onClick={handleSubmit}
              loading={createMutation.isPending}
              colorScheme="blue"
            >
              Create
            </Button>
          </Stack>
        </DialogFooter>
      </DialogContent>
    </DialogRoot>
  )
}
