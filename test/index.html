import React, { useState } from 'react';
import {
  Modal,
  DialogContent,
  DialogHeader,
  DialogCloseTrigger,
  DialogBody,
  DialogFooter,
  DialogBackdrop,
  DialogRoot,
  Button,
  Field,
  Input,
  SelectContent,
  SelectItem,
  SelectRoot,
  SelectTrigger,
  SelectValueText,
  Textarea,
  Grid,
  VStack,
  Checkbox,
  CheckboxGroup as ChakraCheckboxGroup,
  Box,
  Text,
} from '@chakra-ui/react';

interface RestrictedIssuerFormProps {
  isOpen: boolean;
  onClose: () => void;
}

const RestrictedIssuerForm: React.FC<RestrictedIssuerFormProps> = ({ isOpen, onClose }) => {
  const [formData, setFormData] = useState({
    issuerName: '',
    issuerType: 'Public',
    ticker: '',
    isin: '',
    cusip: '',
    sedol: '',
    instrumentType: 'Equity',
    restrictionCategory: '',
    allowedTransactionTypes: ['None'],
    startDate: '08/25/2025',
    restrictionRequester: '',
    restrictionNotes: '',
  });

  const handleInputChange = (field: string, value: string) => {
    setFormData(prev => ({
      ...prev,
      [field]: value
    }));
  };

  const handleTransactionTypeChange = (values: string[]) => {
    let newValues = [...values];
    
    // If "None" is being selected
    if (values.includes('None') && !formData.allowedTransactionTypes.includes('None')) {
      newValues = ['None']; // Only keep "None"
    }
    // If any other option is being selected while "None" is already selected
    else if (values.length > 1 && formData.allowedTransactionTypes.includes('None')) {
      newValues = values.filter(value => value !== 'None'); // Remove "None"
    }
    // If "None" is being deselected and no other options are selected
    else if (!values.includes('None') && values.length === 0) {
      newValues = ['None']; // Default back to "None"
    }
    
    setFormData(prev => ({
      ...prev,
      allowedTransactionTypes: newValues
    }));
  };

  const handleSubmit = () => {
    console.log('Form submitted:', formData);
    onClose();
  };

  return (
    <DialogRoot open={isOpen} onOpenChange={(e) => !e.open && onClose()} size="4xl">
      <DialogBackdrop bg="rgba(0, 0, 0, 0.6)" />
      <DialogContent bg="#2D3748" color="white" maxW="800px">
        <DialogHeader fontSize="lg" fontWeight="semibold">
          Add New Restricted Issuer
        </DialogHeader>
        <DialogCloseTrigger />
        
        <DialogBody pb="6">
          <Grid columns={2} gap="6">
            {/* Left Column */}
            <VStack gap="4" align="stretch">
              <Field.Root>
                <Field.Label fontSize="sm" color="#CBD5E0">Issuer Name</Field.Label>
                <Input
                  placeholder="Enter value"
                  bg="#4A5568"
                  border="none"
                  _placeholder={{ color: "#A0AEC0" }}
                  value={formData.issuerName}
                  onChange={(e) => handleInputChange('issuerName', e.target.value)}
                />
              </Field.Root>

              <Field.Root>
                <Field.Label fontSize="sm" color="#CBD5E0">Ticker</Field.Label>
                <Input
                  placeholder="Enter value"
                  bg="#4A5568"
                  border="none"
                  _placeholder={{ color: "#A0AEC0" }}
                  value={formData.ticker}
                  onChange={(e) => handleInputChange('ticker', e.target.value)}
                />
              </Field.Root>

              <Field.Root>
                <Field.Label fontSize="sm" color="#CBD5E0">CUSIP</Field.Label>
                <Input
                  placeholder="Enter value"
                  bg="#4A5568"
                  border="none"
                  _placeholder={{ color: "#A0AEC0" }}
                  value={formData.cusip}
                  onChange={(e) => handleInputChange('cusip', e.target.value)}
                />
              </Field.Root>

              <Field.Root>
                <Field.Label fontSize="sm" color="#CBD5E0">Instrument Type</Field.Label>
                <SelectRoot
                  value={[formData.instrumentType]}
                  onValueChange={(e) => handleInputChange('instrumentType', e.value[0])}
                >
                  <SelectTrigger
                    bg="#4A5568"
                    border="none"
                  >
                    <SelectValueText />
                  </SelectTrigger>
                  <SelectContent
                    bg="#4A5568"
                  >
                    <SelectItem item="Equity">Equity</SelectItem>
                    <SelectItem item="Bond">Bond</SelectItem>
                    <SelectItem item="Option">Option</SelectItem>
                  </SelectContent>
                </SelectRoot>
              </Field.Root>

              <Field.Root>
                <Field.Label fontSize="sm" color="#CBD5E0">Allowed Transaction Type</Field.Label>
                <SelectRoot>
                  <SelectTrigger
                    bg="#4A5568"
                  border="none"
                    size="sm"
                    mb="2"
                  >
                    <SelectValueText placeholder="Select Below" />
                  </SelectTrigger>
                </SelectRoot>
                <Box bg="#4A5568" p="3" borderRadius="md" maxH="120px" overflowY="auto">
                  <ChakraCheckboxGroup
                    value={formData.allowedTransactionTypes}
                    onValueChange={handleTransactionTypeChange}
                  >
                    <VStack align="start" gap="1">
                      <Checkbox value="Buy" size="sm">Buy</Checkbox>
                      <Checkbox value="Sell" size="sm">Sell</Checkbox>
                      <Checkbox value="Buy to Cover" size="sm">Buy to Cover</Checkbox>
                      <Checkbox value="Sell Short" size="sm">Sell Short</Checkbox>
                      <Checkbox value="None" size="sm">None</Checkbox>
                    </VStack>
                  </ChakraCheckboxGroup>
                </Box>
              </Field.Root>

              <Field.Root>
                <Field.Label fontSize="sm" color="#CBD5E0">Restriction Requester</Field.Label>
                <Input
                  placeholder="Enter value"
                  bg="#4A5568"
                  border="none"
                  _placeholder={{ color: "#A0AEC0" }}
                  value={formData.restrictionRequester}
                  onChange={(e) => handleInputChange('restrictionRequester', e.target.value)}
                />
              </Field.Root>
            </VStack>

            {/* Right Column */}
            <VStack gap="4" align="stretch">
              <Field.Root>
                <Field.Label fontSize="sm" color="#CBD5E0">Issuer Type</Field.Label>
                <SelectRoot
                  value={[formData.issuerType]}
                  onValueChange={(e) => handleInputChange('issuerType', e.value[0])}
                >
                  <SelectTrigger
                    bg="#4A5568"
                    border="none"
                  >
                    <SelectValueText />
                  </SelectTrigger>
                  <SelectContent
                    bg="#4A5568"
                  >
                    <SelectItem item="Public">Public</SelectItem>
                    <SelectItem item="Private">Private</SelectItem>
                  </SelectContent>
                </SelectRoot>
              </Field.Root>

              <Field.Root>
                <Field.Label fontSize="sm" color="#CBD5E0">ISIN</Field.Label>
                <Input
                  placeholder="Enter value"
                  bg="#4A5568"
                  border="none"
                  _placeholder={{ color: "#A0AEC0" }}
                  value={formData.isin}
                  onChange={(e) => handleInputChange('isin', e.target.value)}
                />
              </Field.Root>

              <Field.Root>
                <Field.Label fontSize="sm" color="#CBD5E0">SEDOL</Field.Label>
                <Input
                  placeholder="Enter value"
                  bg="#4A5568"
                  border="none"
                  _placeholder={{ color: "#A0AEC0" }}
                  value={formData.sedol}
                  onChange={(e) => handleInputChange('sedol', e.target.value)}
                />
              </Field.Root>

              <Field.Root>
                <Field.Label fontSize="sm" color="#CBD5E0">Restriction Category</Field.Label>
                <SelectRoot
                  value={formData.restrictionCategory ? [formData.restrictionCategory] : []}
                  onValueChange={(e) => handleInputChange('restrictionCategory', e.value[0] || '')}
                >
                  <SelectTrigger
                    bg="#4A5568"
                    border="none"
                  >
                    <SelectValueText placeholder="Select Below" />
                  </SelectTrigger>
                  <SelectContent
                    bg="#4A5568"
                  >
                    <SelectItem item="Category 1">Category 1</SelectItem>
                    <SelectItem item="Category 2">Category 2</SelectItem>
                  </SelectContent>
                </SelectRoot>
              </Field.Root>

              <Field.Root>
                <Field.Label fontSize="sm" color="#CBD5E0">Start Date</Field.Label>
                <Input
                  type="date"
                  bg="#4A5568"
                  border="none"
                  value="2025-08-25"
                  onChange={(e) => handleInputChange('startDate', e.target.value)}
                />
              </Field.Root>

              <Field.Root>
                <Field.Label fontSize="sm" color="#CBD5E0">Restriction Notes</Field.Label>
                <Textarea
                  placeholder="Enter value"
                  bg="#4A5568"
                  border="none"
                  _placeholder={{ color: "#A0AEC0" }}
                  rows={4}
                  value={formData.restrictionNotes}
                  onChange={(e) => handleInputChange('restrictionNotes', e.target.value)}
                />
              </Field.Root>
            </VStack>
          </Grid>
        </DialogBody>

        <DialogFooter>
          <Button 
            colorPalette="red" 
            mr="3" 
            onClick={onClose}
            bg="#E53E3E"
            _hover={{ bg: "#C53030" }}
          >
            Close
          </Button>
          <Button 
            colorPalette="blue" 
            onClick={handleSubmit}
            bg="#2B6CB0"
            _hover={{ bg: "#2C5282" }}
          >
            Submit
          </Button>
        </DialogFooter>
      </DialogContent>
    </DialogRoot>
  );
};

export default RestrictedIssuerForm;
