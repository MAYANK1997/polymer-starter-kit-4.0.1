import {
  DialogRoot,
  DialogContent,
  DialogHeader,
  DialogBody,
  DialogFooter,
  DialogTitle,
  DialogCloseTrigger,
} from '@chakra-ui/react'
import { Button, Text, HStack, useToast, Alert, AlertIcon } from '@chakra-ui/react'
import { useMutation, useQueryClient } from '@tanstack/react-query'

interface Category {
  id: string
  restrictionCategoryName: string
}

interface DeleteCategoryModalProps {
  isOpen: boolean
  onClose: () => void
  category?: Category | null
}

export function DeleteCategoryModal({ isOpen, onClose, category }: DeleteCategoryModalProps) {
  const queryClient = useQueryClient()
  const toast = useToast()

  const deleteMutation = useMutation({
    mutationFn: async (categoryId: string) => {
      // Mock API call
      await new Promise(resolve => setTimeout(resolve, 1000))
      return categoryId
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['restriction-categories'] })
      toast({
        title: 'Category Deleted',
        description: 'The restriction category has been deleted successfully.',
        status: 'success',
        duration: 3000,
        isClosable: true,
      })
      onClose()
    },
    onError: () => {
      toast({
        title: 'Error',
        description: 'Failed to delete restriction category.',
        status: 'error',
        duration: 3000,
        isClosable: true,
      })
    },
  })

  const handleDelete = () => {
    if (category?.id) {
      deleteMutation.mutate(category.id)
    }
  }

  if (!category) return null

  return (
    <DialogRoot open={isOpen} onOpenChange={(e) => !e.open && onClose()}>
      <DialogContent bg="gray.800" color="white" rounded="xl" shadow="xl">
        <DialogHeader>
          <DialogTitle>Delete Restriction Category</DialogTitle>
          <DialogCloseTrigger />
        </DialogHeader>

        <DialogBody>
          <Alert status="warning" bg="orange.900" borderRadius="md" mb={4}>
            <AlertIcon />
            <Text fontSize="sm">
              This action cannot be undone. This will permanently delete the restriction category.
            </Text>
          </Alert>

          <Text mb={4}>
            Are you sure you want to delete the restriction category:
          </Text>

          <Text fontWeight="bold" color="red.300" mb={6}>
            "{category.restrictionCategoryName}"
          </Text>
        </DialogBody>

        <DialogFooter>
          <HStack justify="flex-end" spacing={3}>
            <Button onClick={onClose} variant="outline" colorScheme="gray">
              Cancel
            </Button>
            <Button
              onClick={handleDelete}
              isLoading={deleteMutation.isPending}
              colorScheme="red"
            >
              Delete Category
            </Button>
          </HStack>
        </DialogFooter>
      </DialogContent>
    </DialogRoot>
  )
}
